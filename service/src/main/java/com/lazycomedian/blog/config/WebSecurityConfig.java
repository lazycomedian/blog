package com.lazycomedian.blog.config;import com.lazycomedian.blog.common.handler.auth.AuthenticationEntryPointImpl;import com.lazycomedian.blog.common.handler.auth.AuthenticationFailHandlerImpl;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.config.annotation.ObjectPostProcessor;import org.springframework.security.config.annotation.web.builders.HttpSecurity;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;import org.springframework.security.core.session.SessionRegistry;import org.springframework.security.core.session.SessionRegistryImpl;import org.springframework.security.web.access.intercept.FilterSecurityInterceptor;/** * @author lazyComedian * @date 2022/6/29 16:19 **/@Configuration@EnableWebSecuritypublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {    @Autowired    private AuthenticationEntryPointImpl authenticationEntryPoint;    @Autowired    private AuthenticationFailHandlerImpl authenticationFailHandler;    @Bean    public SessionRegistry sessionRegistry() {        return new SessionRegistryImpl();    }    @Override    protected void configure(HttpSecurity http) throws Exception {        // 配置登录注销路径        http.formLogin()                .loginProcessingUrl("/login")                .failureHandler(authenticationFailHandler)                .and()                .logout()                .logoutUrl("/logout");        // 配置路由权限信息        http.authorizeRequests()                .withObjectPostProcessor(new ObjectPostProcessor<FilterSecurityInterceptor>() {                    @Override                    public <O extends FilterSecurityInterceptor> O postProcess(O fsi) {//                        fsi.setSecurityMetadataSource(securityMetadataSource());//                        fsi.setAccessDecisionManager(accessDecisionManager());                        return fsi;                    }                })                .anyRequest().permitAll()                .and()                // 关闭跨站请求防护                .csrf().disable().exceptionHandling()                // 未登录处理                .authenticationEntryPoint(authenticationEntryPoint);    }}